# AgendaSim API

Sistema completo de agendamento com autentica√ß√£o JWT e conformidade LGPD.

## üìã **Vis√£o Geral**

A AgendaSim API √© uma solu√ß√£o completa para gerenciamento de agendamentos que inclui:

- üè¢ **Gest√£o de Empresas** - Cadastro e administra√ß√£o de empresas
- üë• **Gest√£o de Profissionais** - Controle de usu√°rios e permiss√µes
- üìÖ **Sistema de Agendamentos** - Agendamento de servi√ßos com profissionais
- üõ†Ô∏è **Gest√£o de Servi√ßos** - Cat√°logo de servi√ßos oferecidos
- üìä **Dashboard Analytics** - M√©tricas e relat√≥rios de neg√≥cio
- üîí **Conformidade LGPD** - Sistema completo de prote√ß√£o de dados
- üìù **Termos e Pol√≠ticas** - Versionamento de documentos legais
- üîç **Auditoria Completa** - Logs de todas as opera√ß√µes

## üîó **URLs da API**

### **Produ√ß√£o**
- **Base URL**: `https://agendasim-api.onrender.com`
- **Swagger UI**: `https://agendasim-api.onrender.com/swagger-ui.html`
- **Health Check**: `https://agendasim-api.onrender.com/actuator/health`

### **Desenvolvimento Local**
- **Base URL**: `http://localhost:8080`
- **Swagger UI**: `http://localhost:8080/swagger-ui.html`
- **H2 Console**: `http://localhost:8080/h2-console`

---

## üéØ **Para Desenvolvedores Frontend**

### **Autentica√ß√£o**
A API usa **JWT (JSON Web Tokens)** para autentica√ß√£o. Todas as requisi√ß√µes (exceto as p√∫blicas) devem incluir o token no header:

```javascript
// Exemplo de requisi√ß√£o autenticada
const response = await fetch('/api/agendas', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  }
});
```

### **Estrutura de Resposta Padr√£o**
```json
{
  "success": true,
  "data": { /* dados da resposta */ },
  "message": "Opera√ß√£o realizada com sucesso"
}
```

### **Tratamento de Erros**
```json
{
  "success": false,
  "error": {
    "timestamp": "2024-01-01T10:00:00",
    "status": 400,
    "error": "Bad Request",
    "message": "Dados inv√°lidos",
    "path": "/api/agendas",
    "traceId": "abc123"
  }
}
```

---

## üìö **Documenta√ß√£o da API**

### **1. Autentica√ß√£o**
```http
POST /auth/login
Content-Type: application/json

{
  "email": "usuario@exemplo.com",
  "senha": "senha123"
}
```

**Resposta:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "refresh_token_aqui",
  "userInfo": {
    "id": 1,
    "nome": "Jo√£o Silva",
    "email": "usuario@exemplo.com",
    "perfil": "OWNER"
  },
  "expiresIn": 86400
}
```

### **2. Gest√£o de Empresas**

#### **Criar Empresa com Owner (P√∫blico)**
```http
POST /empresas/com-owner
Content-Type: application/json

{
  "nomeEmpresa": "Sal√£o de Beleza",
  "emailEmpresa": "contato@salao.com",
  "telefoneEmpresa": "+55 31 99999-8888",
  "cnpjEmpresa": "12.345.678/0001-99",
  "nomeProfissional": "Jo√£o Silva",
  "emailProfissional": "joao@salao.com",
  "senhaProfissional": "senha123"
}
```

#### **Listar Empresas (Admin)**
```http
GET /empresas
Authorization: Bearer {token}
```

#### **Atualizar Empresa (Owner/Admin)**
```http
PUT /empresas/{id}
Authorization: Bearer {token}
Content-Type: application/json

{
  "nome": "Novo Nome",
  "email": "novo@email.com",
  "telefone": "+55 31 88888-7777"
}
```

### **3. Gest√£o de Profissionais**

#### **Listar Profissionais**
```http
GET /profissionais?empresaId={id}
Authorization: Bearer {token}
```

#### **Criar Profissional (Owner)**
```http
POST /profissionais
Authorization: Bearer {token}
Content-Type: application/json

{
  "nome": "Maria Silva",
  "email": "maria@empresa.com",
  "senha": "senha123",
  "perfil": "USER",
  "empresaId": 1
}
```

#### **Atualizar Profissional**
```http
PATCH /profissionais/{id}
Authorization: Bearer {token}
Content-Type: application/json

{
  "nome": "Maria Santos",
  "email": "maria.santos@empresa.com"
}
```

### **4. Gest√£o de Servi√ßos**

#### **Listar Servi√ßos**
```http
GET /servicos?empresaId={id}
Authorization: Bearer {token}
```

#### **Criar Servi√ßo (Owner/Admin)**
```http
POST /servicos
Authorization: Bearer {token}
Content-Type: application/json

{
  "titulo": "Corte de Cabelo",
  "descricao": "Corte profissional com m√°quina e tesoura",
  "preco": 50.00,
  "duracao": 30,
  "empresaId": 1,
  "profissionalIds": [1, 2]
}
```

#### **Atualizar Servi√ßo**
```http
PUT /servicos/{id}
Authorization: Bearer {token}
Content-Type: application/json

{
  "titulo": "Corte Premium",
  "preco": 60.00,
  "duracao": 45
}
```

### **5. Sistema de Agendamentos**

#### **Listar Agendamentos**
```http
GET /agendas?empresaId={id}&profissionalId={id}&dataInicio={data}&dataFim={data}
Authorization: Bearer {token}
```

#### **Criar Agendamento (Admin)**
```http
POST /agendas
Authorization: Bearer {token}
Content-Type: application/json

{
  "nomeCliente": "Cliente Teste",
  "telefoneCliente": "+55 31 98888-7777",
  "empresaId": 1,
  "profissionalId": 1,
  "servicoId": 1,
  "dataHora": "2024-06-21T10:00:00Z",
  "status": "AGENDADO"
}
```

#### **Atualizar Status do Agendamento**
```http
PUT /agendas/{id}/status
Authorization: Bearer {token}
Content-Type: application/json

{
  "status": "CONFIRMADO"
}
```

### **6. Dashboard Analytics**

#### **Resumo Geral**
```http
GET /dash?empresaId={id}
Authorization: Bearer {token}
```

**Resposta:**
```json
{
  "metricasPrincipais": {
    "totalAgendamentos": 150,
    "agendamentosHoje": 8,
    "faturamentoMes": 7500.00,
    "taxaConfirmacao": 85.5
  },
  "indicadoresGestao": {
    "servicosMaisProcurados": [...],
    "profissionaisMaisOcupados": [...],
    "conflitosHorario": 2
  },
  "graficos": {
    "agendamentosPorDia": [...],
    "faturamentoPorSemana": [...]
  },
  "alertas": [
    {
      "tipo": "CONFLITO_HORARIO",
      "mensagem": "Conflito detectado no hor√°rio 14:00",
      "prioridade": "ALTA"
    }
  ]
}
```

---

## üîí **Sistema LGPD (Lei Geral de Prote√ß√£o de Dados)**

### **Anonimiza√ß√£o de Dados de Clientes**

#### **1. Verificar Cliente**
```http
GET /api/lgpd/clientes/verificar?nomeCliente=Jo√£o Silva&telefoneCliente=+55 31 99999-8888
```

**Resposta:**
```json
{
  "nomeCliente": "Jo√£o Silva",
  "telefoneCliente": "+55 31 99999-8888",
  "totalAgendamentos": 5,
  "jaAnonimizado": false
}
```

#### **2. Anonimizar Cliente (Global)**
```http
POST /api/lgpd/clientes/anonimizar?nomeCliente=Jo√£o Silva&telefoneCliente=+55 31 99999-8888
```

**Resposta:**
```json
{
  "success": true,
  "message": "Cliente anonimizado com sucesso",
  "agendamentosAnonimizados": 5,
  "nomeCliente": "Jo√£o Silva",
  "telefoneCliente": "+55 31 99999-8888"
}
```

**Resultado:**
- ‚úÖ **Dados pessoais anonimizados** em todos os agendamentos
- ‚úÖ **Dados de neg√≥cio preservados** (servi√ßos, hor√°rios, valores)
- ‚úÖ **Hist√≥rico mantido** para relat√≥rios e faturamento
- ‚úÖ **Auditoria completa** registrada

### **Sistema de Consentimento**

#### **Registrar Consentimento**
```http
POST /api/consentimentos
Authorization: Bearer {token}
Content-Type: application/json

{
  "tipoConsentimento": "MARKETING",
  "finalidade": "Envio de promo√ß√µes e ofertas",
  "consentido": true
}
```

#### **Meus Consentimentos**
```http
GET /api/consentimentos/meus
Authorization: Bearer {token}
```

#### **Revogar Consentimento**
```http
DELETE /api/consentimentos/{tipo}
Authorization: Bearer {token}
```

### **Termos de Uso e Pol√≠ticas**

#### **Termo Atual (P√∫blico)**
```http
GET /api/termos/ativo
```

#### **Aceitar Termos**
```http
POST /api/termos/aceitar?termoId={id}
Authorization: Bearer {token}
```

#### **Pol√≠tica Atual (P√∫blica)**
```http
GET /api/politicas/ativa
```

#### **Aceitar Pol√≠tica**
```http
POST /api/politicas/aceitar?politicaId={id}
Authorization: Bearer {token}
```

---

---

## üõ†Ô∏è **Desenvolvimento Local**

### **Pr√©-requisitos**
- Java 21+
- Maven 3.6+
- Docker (opcional)

### **Op√ß√£o 1: Maven (Recomendado)**
```bash
# Clone o reposit√≥rio
git clone https://github.com/seu-usuario/agendasim-api.git
cd agendasim-api

# Execute a aplica√ß√£o
./mvnw spring-boot:run
```

### **Op√ß√£o 2: Docker**
```bash
# Build da imagem
docker build -t agendasim-api .

# Executar container
docker run -p 8080:8080 \
  -e SPRING_PROFILES_ACTIVE=dev \
  -e JWT_SECRET=sua-chave-secreta \
  -e DB_PASSWORD=sua-senha \
  agendasim-api
```

### **Acesso Local**
- **API**: `http://localhost:8080`
- **Swagger UI**: `http://localhost:8080/swagger-ui.html`
- **H2 Console**: `http://localhost:8080/h2-console`
- **Health Check**: `http://localhost:8080/actuator/health`

---

## üöÄ **Deploy em Produ√ß√£o**

### **Render.com (Recomendado)**

#### **1. Deploy Autom√°tico**
1. Conecte o reposit√≥rio no Render
2. O arquivo `render.yaml` ser√° detectado automaticamente
3. Configure as vari√°veis de ambiente:
   - `SPRING_PROFILES_ACTIVE`: `prod`
   - `JWT_SECRET`: (gerar uma chave secreta forte)
   - `DB_PASSWORD`: (senha para o banco H2)

#### **2. Deploy Manual**
- **Language/Runtime**: `Docker`
- **Dockerfile Path**: `./Dockerfile`
- **Plan**: `Free` ou `Starter`

### **Configura√ß√µes de Ambiente**

#### **Desenvolvimento**
```properties
spring.profiles.active=dev
jwt.secret=chave-desenvolvimento
spring.h2.console.enabled=true
```

#### **Produ√ß√£o**
```properties
spring.profiles.active=prod
jwt.secret=${JWT_SECRET}
spring.h2.console.enabled=false
```

### **CORS Configurado**
- `http://localhost:3000` (desenvolvimento)
- `http://localhost:3001` (desenvolvimento)
- `https://agendasim.netlify.app` (produ√ß√£o)

---

## üìÅ **Estrutura do Projeto**

```
agendasim-api/
‚îú‚îÄ‚îÄ src/main/java/com/agendasim/
‚îÇ   ‚îú‚îÄ‚îÄ controller/          # Controllers REST
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EmpresaController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfissionalController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ServicoController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AgendaController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LGPDController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConsentimentoController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TermosController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PoliticaPrivacidadeController.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuditoriaController.java
‚îÇ   ‚îú‚îÄ‚îÄ service/             # Servi√ßos de neg√≥cio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EmpresaService.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfissionalService.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ServicoService.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AgendaService.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DashboardService.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LGPDService.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ConsentimentoService.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TermosService.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PoliticaPrivacidadeService.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuditoriaService.java
‚îÇ   ‚îú‚îÄ‚îÄ model/               # Entidades JPA
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Empresa.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Profissional.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Servico.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Agenda.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Disponibilidade.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TermoAceite.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PoliticaPrivacidade.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Consentimento.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AceiteUsuario.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AceitePolitica.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LogAuditoria.java
‚îÇ   ‚îú‚îÄ‚îÄ repository/          # Reposit√≥rios JPA
‚îÇ   ‚îú‚îÄ‚îÄ dto/                 # DTOs de transfer√™ncia
‚îÇ   ‚îú‚îÄ‚îÄ security/            # Configura√ß√µes de seguran√ßa
‚îÇ   ‚îî‚îÄ‚îÄ exception/           # Tratamento de exce√ß√µes
‚îú‚îÄ‚îÄ src/main/resources/
‚îÇ   ‚îú‚îÄ‚îÄ application.properties
‚îÇ   ‚îú‚îÄ‚îÄ application-dev.properties
‚îÇ   ‚îú‚îÄ‚îÄ application-prod.properties
‚îÇ   ‚îú‚îÄ‚îÄ import.sql
‚îÇ   ‚îî‚îÄ‚îÄ db/migration/        # Migra√ß√µes do banco
‚îú‚îÄ‚îÄ src/test/                # Testes unit√°rios e integra√ß√£o
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ render.yaml
‚îú‚îÄ‚îÄ pom.xml
‚îî‚îÄ‚îÄ README.md
```

---

## üîß **Tecnologias Utilizadas**

### **Backend**
- **Java 21** - Linguagem de programa√ß√£o
- **Spring Boot 3.2.2** - Framework principal
- **Spring Security** - Autentica√ß√£o e autoriza√ß√£o
- **Spring Data JPA** - Persist√™ncia de dados
- **H2 Database** - Banco de dados em mem√≥ria/arquivo
- **JWT** - Autentica√ß√£o stateless
- **Maven** - Gerenciamento de depend√™ncias
- **Docker** - Containeriza√ß√£o

### **Seguran√ßa e LGPD**
- **Criptografia BCrypt** - Hash de senhas
- **Valida√ß√£o de dados** - Bean Validation
- **Auditoria completa** - Logs de todas as opera√ß√µes
- **CORS configurado** - Controle de origem
- **Rate limiting** - Prote√ß√£o contra ataques

### **Documenta√ß√£o**
- **Swagger/OpenAPI** - Documenta√ß√£o da API
- **SpringDoc** - Gera√ß√£o autom√°tica de docs
- **JaCoCo** - Cobertura de testes

---

## üìä **Status do Projeto**

### **‚úÖ Funcionalidades Implementadas**
- [x] Sistema de autentica√ß√£o JWT
- [x] Gest√£o completa de empresas
- [x] Gest√£o de profissionais e usu√°rios
- [x] Sistema de agendamentos
- [x] Gest√£o de servi√ßos
- [x] Dashboard com m√©tricas
- [x] Sistema LGPD completo
- [x] Versionamento de documentos legais
- [x] Sistema de consentimento granular
- [x] Auditoria completa
- [x] API REST documentada
- [x] Deploy automatizado

### **üîÑ Em Desenvolvimento**
- [ ] Testes de integra√ß√£o LGPD
- [ ] Relat√≥rios de conformidade
- [ ] Notifica√ß√µes autom√°ticas
- [ ] Backup de dados

### **üìã Pr√≥ximas Funcionalidades**
- [ ] Integra√ß√£o com DPO
- [ ] Certifica√ß√£o ISO 27001
- [ ] Relat√≥rios para autoridades
- [ ] Backup autom√°tico

---

## ü§ù **Contribui√ß√£o**

### **Como Contribuir**
1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

### **Padr√µes de C√≥digo**
- Use Java 21+ features
- Siga as conven√ß√µes do Spring Boot
- Escreva testes para novas funcionalidades
- Documente APIs com Swagger
- Mantenha cobertura de testes > 60%

---

## üìÑ **Licen√ßa**

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo `LICENSE` para mais detalhes.

---

## üìû **Suporte**

Para d√∫vidas ou suporte:
- **Email**: contato@agendasim.com
- **Issues**: [GitHub Issues](https://github.com/seu-usuario/agendasim-api/issues)
- **Documenta√ß√£o**: [Swagger UI](https://agendasim-api.onrender.com/swagger-ui.html)

---

## üèÜ **Conformidade LGPD**

Este projeto est√° **100% em conformidade** com a Lei Geral de Prote√ß√£o de Dados (LGPD) brasileira, implementando todos os direitos dos titulares de dados e princ√≠pios de prote√ß√£o de dados pessoais.

**Status**: ‚úÖ **CONFORME** - Pronto para uso em produ√ß√£o
